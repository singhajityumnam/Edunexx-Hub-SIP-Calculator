<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edunexx Hub - All-in-One SIP & SWP Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f9fafb;
        padding: 10px;
        margin: 0;
    }
    .container {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        max-width: 800px;
        margin: auto;
    }
    h2 {
        text-align: center;
        color: #1e3a8a;
    }
    .tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    .tab {
        padding: 8px 15px;
        cursor: pointer;
        background: #e5e7eb;
        margin: 3px;
        border-radius: 5px;
    }
    .tab.active {
        background: #2563eb;
        color: white;
    }
    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
    }
    input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }
    button {
        margin-top: 10px;
        padding: 10px;
        width: 100%;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover {
        background: #1e40af;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 14px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 6px;
        text-align: right;
    }
    th {
        background: #f1f5f9;
    }
    canvas {
        margin-top: 20px;
    }
</style>
</head>
<body>

<div class="container">
    <h2>ðŸ’° Edunexx Hub - All-in-One SIP & SWP Calculator</h2>

    <div class="tabs">
        <div class="tab active" onclick="switchMode('sip')">SIP</div>
        <div class="tab" onclick="switchMode('swp')">SWP</div>
        <div class="tab" onclick="switchMode('hybrid')">Hybrid</div>
    </div>

    <!-- SIP Form -->
    <div id="sipForm">
        <label>Monthly Investment (â‚¹):</label>
        <input type="number" id="sipMonthly" placeholder="e.g. 5000">
        <label>Lumpsum (Optional â‚¹):</label>
        <input type="number" id="sipLumpsum" placeholder="e.g. 100000">
        <label>Annual Return (%):</label>
        <input type="number" id="sipReturn" placeholder="e.g. 12">
        <label>Duration (Years):</label>
        <input type="number" id="sipYears" placeholder="e.g. 10">
        <label>Inflation Rate (%):</label>
        <input type="number" id="sipInflation" placeholder="e.g. 6">
        <label>Tax Rate on Returns (%):</label>
        <input type="number" id="sipTax" placeholder="e.g. 10">
        <button onclick="calculateSIP()">Calculate SIP</button>
    </div>

    <!-- SWP Form -->
    <div id="swpForm" style="display:none;">
        <label>Initial Investment (â‚¹):</label>
        <input type="number" id="swpInitial" placeholder="e.g. 1000000">
        <label>Monthly Withdrawal (â‚¹):</label>
        <input type="number" id="swpWithdraw" placeholder="e.g. 10000">
        <label>Annual Return (%):</label>
        <input type="number" id="swpReturn" placeholder="e.g. 8">
        <label>Duration (Years):</label>
        <input type="number" id="swpYears" placeholder="e.g. 10">
        <label>Inflation Rate (%):</label>
        <input type="number" id="swpInflation" placeholder="e.g. 6">
        <label>Tax Rate on Returns (%):</label>
        <input type="number" id="swpTax" placeholder="e.g. 10">
        <button onclick="calculateSWP()">Calculate SWP</button>
    </div>

    <!-- Hybrid Form -->
    <div id="hybridForm" style="display:none;">
        <label>Initial Investment (â‚¹):</label>
        <input type="number" id="hybridInitial" placeholder="e.g. 100000">
        <label>Monthly SIP (â‚¹):</label>
        <input type="number" id="hybridMonthly" placeholder="e.g. 5000">
        <label>Annual Return (%):</label>
        <input type="number" id="hybridReturn" placeholder="e.g. 12">
        <label>Duration (Years):</label>
        <input type="number" id="hybridYears" placeholder="e.g. 10">
        <label>Inflation Rate (%):</label>
        <input type="number" id="hybridInflation" placeholder="e.g. 6">
        <label>Tax Rate on Returns (%):</label>
        <input type="number" id="hybridTax" placeholder="e.g. 10">
        <button onclick="calculateHybrid()">Calculate Hybrid</button>
    </div>

    <div id="results"></div>
    <canvas id="growthChart"></canvas>
    <button id="downloadCSVBtn" style="display:none;" onclick="downloadTable('csv')">Download CSV</button>
    <button id="downloadExcelBtn" style="display:none;" onclick="downloadTable('excel')">Download Excel</button>
</div>

<script>
let currentMode = 'sip';
let tableData = [];
let chart;

function switchMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab:nth-child(${mode==='sip'?1:mode==='swp'?2:3})`).classList.add('active');
    document.getElementById('sipForm').style.display = mode==='sip' ? 'block':'none';
    document.getElementById('swpForm').style.display = mode==='swp' ? 'block':'none';
    document.getElementById('hybridForm').style.display = mode==='hybrid' ? 'block':'none';
    document.getElementById('results').innerHTML = '';
    document.getElementById('growthChart').style.display = 'none';
    document.getElementById('downloadCSVBtn').style.display = 'none';
    document.getElementById('downloadExcelBtn').style.display = 'none';
}

function formatCurrency(num) {
    return 'â‚¹' + parseFloat(num).toLocaleString('en-IN', {maximumFractionDigits:2});
}

function calculateSIP() {
    let monthly = parseFloat(document.getElementById('sipMonthly').value) || 0;
    let lumpsum = parseFloat(document.getElementById('sipLumpsum').value) || 0;
    let annualReturn = parseFloat(document.getElementById('sipReturn').value) / 100;
    let years = parseFloat(document.getElementById('sipYears').value);
    let inflation = parseFloat(document.getElementById('sipInflation').value) / 100 || 0;
    let taxRate = parseFloat(document.getElementById('sipTax').value) / 100 || 0;

    let r = annualReturn / 12;
    tableData = [["Year", "Invested", "Returns", "Tax Paid", "Final Value", "Inflation Adjusted"]];
    let invested = lumpsum;
    let balance = lumpsum;
    for (let y=1; y<=years; y++) {
        for (let m=1; m<=12; m++) {
            balance = balance*(1+r) + monthly;
            invested += monthly;
        }
        let returns = balance - invested;
        let tax = returns * taxRate;
        let finalValue = balance - tax;
        let inflationAdjusted = finalValue / Math.pow(1+inflation, y);
        tableData.push([y, invested, returns, tax, finalValue, inflationAdjusted]);
    }
    renderResults();
}

function calculateSWP() {
    let initial = parseFloat(document.getElementById('swpInitial').value);
    let withdraw = parseFloat(document.getElementById('swpWithdraw').value);
    let annualReturn = parseFloat(document.getElementById('swpReturn').value) / 100;
    let years = parseFloat(document.getElementById('swpYears').value);
    let inflation = parseFloat(document.getElementById('swpInflation').value) / 100 || 0;
    let taxRate = parseFloat(document.getElementById('swpTax').value) / 100 || 0;

    let r = annualReturn / 12;
    tableData = [["Year", "Total Withdrawn", "Interest Earned", "Tax Paid", "Remaining Balance", "Inflation Adjusted"]];
    let balance = initial;
    let withdrawn = 0;
    for (let y=1; y<=years; y++) {
        for (let m=1; m<=12; m++) {
            balance = balance*(1+r) - withdraw;
            withdrawn += withdraw;
        }
        let interestEarned = withdrawn - (initial - balance);
        let tax = interestEarned * taxRate;
        let finalValue = balance - tax;
        let inflationAdjusted = finalValue / Math.pow(1+inflation, y);
        tableData.push([y, withdrawn, interestEarned, tax, finalValue, inflationAdjusted]);
    }
    renderResults();
}

function calculateHybrid() {
    let initial = parseFloat(document.getElementById('hybridInitial').value);
    let monthly = parseFloat(document.getElementById('hybridMonthly').value);
    let annualReturn = parseFloat(document.getElementById('hybridReturn').value) / 100;
    let years = parseFloat(document.getElementById('hybridYears').value);
    let inflation = parseFloat(document.getElementById('hybridInflation').value) / 100 || 0;
    let taxRate = parseFloat(document.getElementById('hybridTax').value) / 100 || 0;

    let r = annualReturn / 12;
    tableData = [["Year", "Invested", "Returns", "Tax Paid", "Final Value", "Inflation Adjusted"]];
    let invested = initial;
    let balance = initial;
    for (let y=1; y<=years; y++) {
        for (let m=1; m<=12; m++) {
            balance = balance*(1+r) + monthly;
            invested += monthly;
        }
        let returns = balance - invested;
        let tax = returns * taxRate;
        let finalValue = balance - tax;
        let inflationAdjusted = finalValue / Math.pow(1+inflation, y);
        tableData.push([y, invested, returns, tax, finalValue, inflationAdjusted]);
    }
    renderResults();
}

function renderResults() {
    let html = "<table><tr>";
    tableData[0].forEach(h => html += `<th>${h}</th>`);
    html += "</tr>";
    for (let i=1; i<tableData.length; i++) {
        html += "<tr>" + tableData[i].map(v => `<td>${formatCurrency(v)}</td>`).join('') + "</tr>";
    }
    html += "</table>";
    document.getElementById('results').innerHTML = html;

    // Chart
    document.getElementById('growthChart').style.display = 'block';
    let labels = tableData.slice(1).map(row => "Year " + row[0]);
    let values = tableData.slice(1).map(row => row[row.length-2]);
    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{ label: 'Final Value', data: values, borderColor: '#2563eb', fill: false }]
        }
    });

    document.getElementById('downloadCSVBtn').style.display = 'inline-block';
    document.getElementById('downloadExcelBtn').style.display = 'inline-block';
}

function downloadTable(type) {
    if (type==='csv') {
        let csvContent = tableData.map(row => row.join(",")).join("\n");
        let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `${currentMode.toUpperCase()}_Calculation.csv`;
        link.click();
    } else {
        let ws = XLSX.utils.aoa_to_sheet(tableData);
        let wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Results");
        XLSX.writeFile(wb, `${currentMode.toUpperCase()}_Calculation.xlsx`);
    }
}
</script>

</body>
</html>
